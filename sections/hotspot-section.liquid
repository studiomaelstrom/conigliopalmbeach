{% schema %}
{
  "name": "Hotspot Image",
  "settings": [
    {
      "type": "text",
      "id": "image",
      "label": "Image URL"
    },
    {
      "type": "color",
      "id": "hotspot_color",
      "label": "Hotspot Color",
      "default": "#F47722"
    },
    {
      "type": "color",
      "id": "hotspot_inner",
      "label": "Hotspot Inner Color",
      "default": "#FFF"
    },
    {
      "type": "range",
      "id": "width",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Width",
      "default": 95
    }
  ],
  "blocks": [
    {
      "type": "hotspot",
      "name": "Hotspot",
      "settings": [
        {
      "type": "product",
      "id": "product",
      "label": "Select a product",
      "info": "Choose a product to display in this section."
    },
        {
          "type": "range",
          "id": "top",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Top",
          "default": 50
        },
        {
          "type": "range",
          "id": "left",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Left",
          "default": 50
        }
      ]
    },
    {
      "type": "link",
      "name": "Link",
      "settings": [
        {
      "type": "url",
      "id": "hotspot-url",
      "label": "Hotspot Link"
      },
        {
  "type": "text",
  "id": "tooltip_text",
  "label": "Hover Text",
  "default": "Hover Text Here"
},
        {
          "type": "range",
          "id": "top",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Top",
          "default": 50
        },
        {
          "type": "range",
          "id": "left",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Left",
          "default": 50
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image with Hotspots",
      "category": "Image with hotspots"
    }
  ]
}
{% endschema %}

{%- style -%}
                          .section-{{ section.id }}-width {
                            width: 100%;
                            padding: {{ 100 | minus:section.settings.width | times:1.5}}px;
                            margin:auto;
                          }

                          @media screen and (min-width: 750px) {
                            .section-{{ section.id }}-width {
                              width: {{ section.settings.width }}%;
                              margin:auto;
                            }
                          }

                          .hotspots--wrapper {
                            position: relative;
                            margin: auto;
                          }

                          .hotspots--figure {
                            width: 100%;
                          }

                          .hotspot {
                            position: absolute;
                            display: block;
                          }

                          .hotspot--cta {
                            position: relative;
                            float: right;
                            display: inline-block;
                            width: 25px;
                            height: 25px;
                            border-radius: 50%;
                            background: {{section.settings.hotspot_color}};
                            transition: all cubic-bezier(0.8, 0, 0.2, 1) 0.4s;
                          }

                          .hotspot--cta::after {
                            content: "";
                            position: absolute;
                            left: 0;
                            top: 0;
                            bottom: 0;
                            right: 0;
                            margin: auto;
                            width: 10px;
                            height: 10px;
                            border-radius: 50%;
                            background: {{section.settings.hotspot_inner}};
                            z-index: 2;
                            transition: opacity 0.6s;
                            animation: pulse 1.5s cubic-bezier(0.8, 0, 0.2, 1) 0s infinite;
                          }

                          .hotspot:hover .hotspot--cta {
                            transform: scale(0.6);
                          }

                          .hotspot:hover .hotspot--cta:after {
                            opacity: 0;
                          }

                          @keyframes pulse {
                            0% {
                              transform: scale(0.4);
                            }
                            33% {
                              transform: scale(1);
                            }
                            66% {
                              transform: scale(0.4);
                            }
                            100% {
                              transform: scale(0.4);
                            }
                          }

                          @media screen and (max-width: 770px) {

                          .hotspot--cta {
                            width: 12px;
                            height: 12px;
                            border-radius: 50%;
                            background: transparent;
                            transition: all cubic-bezier(0.8, 0, 0.2, 1) 0.4s;
                          }

                          .hotspot--cta::after {
                            width: 12px;
                            height: 12px;
                            border-radius: 50%;
                            background: {{section.settings.hotspot_color}};
                            z-index: 2;
                            transition: opacity 0.6s;
                            animation: pulse 1.5s cubic-bezier(0.8, 0, 0.2, 1) 0s infinite;
                          }

                          .hotspot:hover .hotspot--cta {
                            transform: scale(0.8);
                            background: {{section.settings.hotspot_color}};
                          }

                          .hotspot:hover .hotspot--cta:after {
                            opacity: 0;
                          }
                          }

                            {%- for block in section.blocks -%}
                              {%- assign hotspot_position = '#hotspot-' | append: block.id -%}
                              {{ hotspot_position }}{
                                top: {{ block.settings.top }}%;
                                left: {{ block.settings.left }}%;
                              }

                        {%- assign info_position = '#info-' | append: block.id -%}
                              {{ info_position }}{
                                top: {{ block.settings.itop }}%;
                                left: {{ block.settings.ileft }}%;
                              }
                            {%- endfor -%}


                    .hotspot--popup {
                    display: none;
                    position: absolute;
                    background-color: white;
                    padding: 10px;
                    border-radius: 5px;
                    box-shadow: 0 0 10px rgba(0,0,0,0.5);
                    z-index: 10;
                    width:400px;
                    margin-bottom:100px!important;
                    /* Adjust width, max-width, etc., as needed */
                  }

                  @keyframes fadeIn {
                  from {
                    opacity: 0;
                  }
                  to {
                    opacity: 1;
                  }
                }

                .fade-in {
                  animation: fadeIn 0.5s ease-out forwards;
                }

                /* Centered Popup Modal */
              .modal {
                display: none; /* Hidden by default */
                position: fixed; /* Stay in place */
                z-index: 100; /* Sit on top */
                left: 0;
                top: 0;
                width: 100%; /* Full width */
                height: 100%; /* Full height */
                overflow: auto; /* Enable scroll if needed */
                margin:auto;
                background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.5s, visibility 0.5s; /* Smooth transition for opacity and visibility */
              }

              /* Fade class to add when showing the modal */
              .fade-in {
                opacity: 1;
                visibility: visible;
              }

              /* Modal Content */
              .modal-content {
                background-color: #fefefe;
                margin: 5% auto; /* 15% from the top and centered */
                padding: 20px;
                border: 1px solid #888;
                max-width: 400px;
                width: 80%;
                max-height: 800px; /* Maximum height */
              }

              /* Modal Content Styles */
            .modal-content img {
              max-height: 500px; /* Maintain aspect ratio */
              width:100%
            }

            .modal-content h3,
            .modal-content a {
              text-align: center; /* Center-align text */
              display: block; /* Make the link take its own line */
              margin-top: 15px; /* Add some space above the title and link */
            }

            /* Outline Button Styles */
            .modal-content a {
              padding: 5px 10px;
              border: 1px solid #F47722; /* Use your theme's primary color or any color you prefer */
              color: #F47722; /* Text color */
              text-decoration: none; /* Remove underline from the link */
              text-transform: uppercase;
              transition: background-color 0.3s, color 0.3s; /* Smooth transition for hover effect */
            }

            .modal-content a:hover {
              background-color: #F47722; /* Button fill color on hover */
              color: #FFFFFF; /* Text color on hover */
            }

            .modal-close-text {
            color: #888; /* Grey text */
            cursor: pointer; /* Indicates the text is clickable */
            text-align: center; /* Center the text */
            margin-top: 8px; /* Space from the content above */
            font-size: 12px; /* Adjust size as needed */
            text-decoration:underline;
              text-underline-offset:2px;
          }

          .link-hotspot {
          display: block;
          position: absolute;
          /* Adjust the size as needed to make the clickable area appropriate */
          width: 25px;
          height: 25px;
          cursor: pointer; /* Indicates the element is clickable */
        }

        .tooltip {
    visibility: hidden;
    width: 120px;
    background-color: black;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px 0;
    position: absolute;
    z-index: 1;
    bottom: 100%;
    left: 50%;
    margin-left: -60px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .hotspot:hover .tooltip, .link-hotspot:hover .tooltip {
    visibility: visible;
    opacity: 1;
  }
{%- endstyle -%}
<div class="section-{{ section.id }}-width">
  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <!-- Dynamic content will be loaded here -->
    </div>
  </div>

  <section class="hotspots--wrapper">
    <img src="{{ section.settings.image }}" alt="" class="hotspots--figure">

    <!-- Hotspots -->
    {%- for block in section.blocks -%}
      {% if block.type == 'hotspot' %}
        <div
          class="hotspot"
          style="top: {{ block.settings.top }}%; left: {{ block.settings.left }}%;"
          onclick="openModal('{{ block.settings.product }}')"
        >
          <span class="hotspot--cta"></span>
          <div class="tooltip">View Product</div>
        </div>
      {% elsif block.type == 'link' %}
        <a
          class="link-hotspot"
          href="{{ block.settings.hotspot-url }}"
          target="_blank"
          style="top: {{ block.settings.top }}%; left: {{ block.settings.left }}%;"
        >
          <span class="hotspot--cta"></span>
          <div class="tooltip">{{ block.settings.tooltip_text }}</div>
        </a>
      {% endif %}
    {%- endfor -%}
  </section>
</div>

<script>
  function openModal(productId) {
    var modal = document.getElementById('myModal');
    var modalContent = document.querySelector('.modal-content');
    // Assuming you have jQuery available for fetching product details
    jQuery.ajax({
      url: '/products/' + productId + '.js',
      dataType: 'json',
      success: function(product) {
        modalContent.innerHTML = '<img src="' + product.images[0] + '" alt="' + product.title + '"><h3>' + product.title + '</h3><a href="' + product.url + '">View Product</a>';
        modal.style.display = 'block';
      }
    });
  }

  // Close the modal if the user clicks anywhere outside of the modal content
  window.onclick = function(event) {
    var modal = document.getElementById('myModal');
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>
